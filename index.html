<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Vladimir Dejanovic, Thomas Segismont">
<title>Implementing the API Gateway pattern with GraphQL</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Implementing the API Gateway pattern with GraphQL</h1>
<div class="details">
<span id="author" class="author">Vladimir Dejanovic</span><br>
<span id="email" class="email"><a href="https://twitter.com/vladimird_42">@vladimird_42</a></span><br>
<span id="author2" class="author">Thomas Segismont</span><br>
<span id="email2" class="email"><a href="https://twitter.com/tsegismont">@tsegismont</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_microservices_architecture">Microservices architecture</a></li>
<li><a href="#_the_api_gateway_pattern">The API Gateway pattern</a></li>
<li><a href="#_serving_many_clients">Serving many clients</a></li>
<li><a href="#_graphql_in_a_nutshell">GraphQL in a nutshell</a>
<ul class="sectlevel3">
<li><a href="#_what_it_is">What it is</a></li>
<li><a href="#_how_it_works">How it works</a></li>
<li><a href="#_api_gateway_engine">API Gateway engine</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_the_musicstore_application">The MusicStore Application</a>
<ul class="sectlevel2">
<li><a href="#_web_client">Web Client</a></li>
<li><a href="#_inventory_service">Inventory Service</a></li>
<li><a href="#_rating_service">Rating Service</a></li>
</ul>
</li>
<li><a href="#_getting_started">Getting started</a>
<ul class="sectlevel2">
<li><a href="#_prerequisites">Prerequisites</a>
<ul class="sectlevel3">
<li><a href="#_java_development_kit">Java Development Kit</a></li>
<li><a href="#_maven">Maven</a></li>
<li><a href="#_ide">IDE</a></li>
<li><a href="#_postgres_database">Postgres database</a></li>
</ul>
</li>
<li><a href="#_importing_the_code">Importing the code</a></li>
<li><a href="#_running_backend_services">Running backend services</a>
<ul class="sectlevel3">
<li><a href="#_inventory">Inventory</a></li>
<li><a href="#_rating">Rating</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_lets_code">Let&#8217;s code!</a>
<ul class="sectlevel2">
<li><a href="#_building_blocks">Building blocks</a>
<ul class="sectlevel3">
<li><a href="#_graphql_java">GraphQL-Java</a></li>
<li><a href="#_eclipse_vert_x">Eclipse Vert.x</a></li>
<li><a href="#_rxjava">RxJava</a></li>
</ul>
</li>
<li><a href="#_steps">Steps</a>
<ul class="sectlevel3">
<li><a href="#_step_0_vert_x_web_router">Step 0: Vert.x Web Router</a></li>
<li><a href="#_step_1_the_graphql_java_runtime">Step 1: The GraphQL-Java runtime</a></li>
<li><a href="#_step_2_field_with_argument">Step 2: field with argument</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_microservices_architecture">Microservices architecture</h3>
<div class="paragraph">
<p>In a <a href="https://microservices.io/patterns/microservices.html">microservices architecture</a>, several loosely coupled, independently deployable services comprise a large software application.</p>
</div>
<div class="paragraph">
<p>This type of design can provide quite a few benefits, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ability to release more often and more reliably</p>
</li>
<li>
<p>codebases easier to reason about</p>
</li>
<li>
<p>independence to a particular technology</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, an online store application could be composed of, among others, an inventory and a rating service:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="microservices-architecture.svg" alt="microservices architecture" width="550" height="130">
</div>
<div class="title">Figure 1. Online store application, microservices architecture</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_api_gateway_pattern">The API Gateway pattern</h3>
<div class="paragraph">
<p>The client side of the application may have to contact several services to display a single screen or page.
For instance, to display a product details page, it needs product info from the inventory service and customer reviews from the rating service.</p>
</div>
<div class="paragraph">
<p>But each network communication comes with a cost.
This applies to desktop browsers with DSL or fiber links, but the impact is particularly significant on mobile networks.</p>
</div>
<div class="paragraph">
<p>This is one important reason why the <em>API Gateway</em> pattern has emerged.
In practice, the client communicates with a single service, the gateway, which communicates with the backend services:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="api-gateway-pattern.svg" alt="api gateway pattern" width="744" height="166">
</div>
<div class="title">Figure 2. API Gateway pattern</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The API Gateway does not eliminate the coordination required to make sense of the backend data.
In fact, it adds a new network hop in the the sequence of service calls.</p>
</div>
<div class="paragraph">
<p>But it moves most of the interactions inside the datacenter, where network latencies are considerably better.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Very often, the API Gateway provides cross-cutting concerns like security.
For example, it could generate a token after authenticating the client and communicate it to the backend services as a proof of identity.</p>
</div>
<div class="paragraph">
<p>It may also provide its own features, if they are only relevant to the frontend.
An e-commerce application, for instance, could manage customers' shopping carts at the API Gateway level.</p>
</div>
<div class="paragraph">
<p>From a performance standpoint, an event-driven implementation would give better results under load.
Indeed, the API Gateway&#8217;s workload is dominated by I/O, so having threads blocked waiting is not an optimal usage of resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serving_many_clients">Serving many clients</h3>
<div class="paragraph">
<p>A lot of applications nowadays must be available from a wide range of clients: browsers, smartphones, tablets, wearables&#8230;&#8203; etc.
These clients all have different capabilities in terms of display and networking.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the product details use case.
For a desktop user, it makes sense to show:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the product info (inventory service)</p>
</li>
<li>
<p>the average rating (rating service)</p>
</li>
<li>
<p>users' reviews (rating service)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, in a smartphone app the reviews would probably be accessible in a separate view because of the screen size and shape.</p>
</div>
<div class="paragraph">
<p>But if the mobile developer uses the same endpoint as the web developer, the API Gateway wastes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>time (<em>latency</em>) waiting for rating service responses, and</p>
</li>
<li>
<p>bandwith sending a lot of unnecessary data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To overcome this problem, it is possible to create a backend specific to each type of frontend.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="backend-for-frontends.svg" alt="backend for frontends" width="865" height="130">
</div>
<div class="title">Figure 3. Backend for Frontends pattern</div>
</div>
<div class="paragraph">
<p>Nevertheless, this design, also known as the <em>Backend for Frontends</em> pattern, has a few drawbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>each specific API Gateway is another component to maintain</p>
</li>
<li>
<p>a lot of code is duplicated</p>
</li>
<li>
<p>each new feature has to be supported in all gateways before all clients can start using it</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_graphql_in_a_nutshell">GraphQL in a nutshell</h3>
<div class="sect3">
<h4 id="_what_it_is">What it is</h4>
<div class="paragraph">
<p><a href="https://graphql.org/">GraphQL</a> is a query and schema definition language for your backend services.</p>
</div>
<div class="paragraph">
<p>It allows backend developers to describe the data in a language-agnostic fashion:</p>
</div>
<div class="listingblock">
<div class="title">GraphQL Schema file</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="graphql"><span class="k">type</span><span class="w"> </span><span class="n">Genre</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">!</span><span class="w">
  </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="k">type</span><span class="w"> </span><span class="n">Album</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">!</span><span class="w">
  </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">
  </span><span class="n">genre</span><span class="p">:</span><span class="w"> </span><span class="n">Genre</span><span class="p">!</span><span class="w">
  </span><span class="n">artist</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">
  </span><span class="n">reviews</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">Review</span><span class="p">!]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="k">type</span><span class="w"> </span><span class="n">Review</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">
  </span><span class="n">rating</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">!</span><span class="w">
  </span><span class="n">comment</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="k">type</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">albums</span><span class="p">(</span><span class="n">genre</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">):</span><span class="w"> </span><span class="p">[</span><span class="n">Album</span><span class="p">!]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="k">schema</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="n">Query</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then frontend developers to request exactly the information they need:</p>
</div>
<div class="listingblock">
<div class="title">GraphQL query</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="p">(</span><span class="nv">$id</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">album</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nv">$id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="w">
    </span><span class="n">name</span><span class="w">
    </span><span class="n">genre</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="n">artist</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which, given an <code>id</code> variable, would result in:</p>
</div>
<div class="listingblock">
<div class="title">GraphQL results</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"album"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Revolver"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"genre"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pop"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"artist"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Beatles"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While the <a href="https://graphql.github.io/graphql-spec/">GraphQL specification</a> does not prescribe any transport, in practice it&#8217;s often used over HTTP and Websockets.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You will find a GraphQL schema definition and query authoring introduction on <a href="https://graphql.org/learn/" class="bare">https://graphql.org/learn/</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_how_it_works">How it works</h4>
<div class="paragraph">
<p>When a GraphQL server runtime starts, it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>parses the schema file to discover types and fields</p>
</li>
<li>
<p>binds each field to data fetching functions</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="graphql-server-runtime.svg" alt="graphql server runtime" width="476" height="154">
</div>
<div class="title">Figure 4. GraphQL server runtime creation</div>
</div>
<div class="paragraph">
<p>Then when a request is received, it:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>validates the query</p>
</li>
<li>
<p>invokes each data fetching function needed to produce the result</p>
</li>
<li>
<p>sends the result to the client</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="graphql-query-execution.svg" alt="graphql query execution" width="520" height="58">
</div>
<div class="title">Figure 5. GraphQL query execution phases</div>
</div>
</div>
<div class="sect3">
<h4 id="_api_gateway_engine">API Gateway engine</h4>
<div class="paragraph">
<p>GraphQL becomes more and more popular, including as a replacement for <em>RESTful</em> or HTTP/JSON APis.</p>
</div>
<div class="paragraph">
<p>But it particularly shines when building API Gateways.
Why?
Let&#8217;s consider the product details use case again.</p>
</div>
<div class="paragraph">
<p>When the desktop client sends a request to the GraphQL runtime, it will ask for product info as well as users' review.
And the runtime will execute the corresponding data fetchers:</p>
</div>
<div class="listingblock">
<div class="title">Desktop client query</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="p">(</span><span class="nv">$id</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">album</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nv">$id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="w">
    </span><span class="n">name</span><span class="w">
    </span><span class="n">genre</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="n">artist</span><span class="w">
    </span><span class="n">reviews</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
      </span><span class="n">comment</span><span class="w">
      </span><span class="n">rating</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the smartphone client will only ask for the product info:</p>
</div>
<div class="listingblock">
<div class="title">Smartphone client query</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="p">(</span><span class="nv">$id</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">album</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nv">$id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="w">
    </span><span class="n">name</span><span class="w">
    </span><span class="n">genre</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="n">artist</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the runtime will <strong>NOT</strong> execute the data fetchers for customers' reviews and, obviously, will not send the unnecessary data.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_musicstore_application">The MusicStore Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>MusicStore</em> is an online music shop.
You can browse its catalog by genre, read customer reviews, see the list of tracks.
When logged-in, you may add albums to your cart, manage your cart items or post your own reviews.</p>
</div>
<div class="paragraph">
<p>Technically, it is comprised of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="#_web_client">Web Client</a></p>
</li>
<li>
<p>the API Gateway which:</p>
<div class="ulist">
<ul>
<li>
<p>serves the static content</p>
</li>
<li>
<p>runs the GraphQL runtime</p>
</li>
<li>
<p>authenticates the customers</p>
</li>
<li>
<p>records cart items</p>
</li>
</ul>
</div>
</li>
<li>
<p>the <a href="#_inventory_service">Inventory Service</a></p>
</li>
<li>
<p>the <a href="#_rating_service">Rating Service</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="musicstore-app.svg" alt="musicstore app" width="696" height="171">
</div>
<div class="title">Figure 6. The <em>MusicStore</em> application</div>
</div>
<div class="paragraph">
<p>You will build the API Gateway for this microservices-based application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In a real-world application, the static content would often be served from a separate component.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_web_client">Web Client</h3>
<div class="paragraph">
<p>A <em>Single Page Application</em> implemented with <a href="https://vuejs.org/">Vue.js</a> and <a href="https://www.apollographql.com/docs/react/">Apollo client</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_inventory_service">Inventory Service</h3>
<div class="paragraph">
<p>The <em>Inventory Service</em> exposes product data over HTTP in JSON format:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>genres</p>
</li>
<li>
<p>albums (name, artist, genre, &#8230;&#8203;etc)</p>
</li>
<li>
<p>tracks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the sake of simplicity, inventory data is loaded on startup from text files and stored into memory.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rating_service">Rating Service</h3>
<div class="paragraph">
<p>The <em>Rating Service</em> receives customers' reviews on albums:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>customer name</p>
</li>
<li>
<p>rating</p>
</li>
<li>
<p>comment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It exposes this data over HTTP in JSON format.
It can also compute an average rating for each album.</p>
</div>
<div class="paragraph">
<p>Again, for simplicity, reviews are stored only in memory.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="sect3">
<h4 id="_java_development_kit">Java Development Kit</h4>
<div class="paragraph">
<p>JDK 8 or later must be installed on our machine.
If you don&#8217;t have it already, you can get one from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://adoptopenjdk.net" class="bare">https://adoptopenjdk.net</a>, or</p>
</li>
<li>
<p><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" class="bare">https://www.oracle.com/technetwork/java/javase/downloads/index.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use either OpenJDK or Oracle JDK.</p>
</div>
</div>
<div class="sect3">
<h4 id="_maven">Maven</h4>
<div class="paragraph">
<p>Download Apache Maven from <a href="https://maven.apache.org/download.cgi" class="bare">https://maven.apache.org/download.cgi</a>.</p>
</div>
<div class="paragraph">
<p>Extract the archive contents to a directory of your choice and add it to the <code>PATH</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ide">IDE</h4>
<div class="paragraph">
<p>It is recommended to use an IDE. It does not matter if it&#8217;s IntelliJ, Eclipse or Netbeans.</p>
</div>
<div class="paragraph">
<p>If you dont have an IDE, follow these instructions to get started with Eclipse:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>browse to the <a href="https://www.eclipse.org/downloads/packages/">Eclipse downloads page</a></p>
</li>
<li>
<p>select the <em>Eclipse IDE for Java Developers</em> package and download it</p>
</li>
<li>
<p>extract the archive contents to a directory of your choice</p>
</li>
<li>
<p>in the destination directory, execute the Eclipse binary</p>
</li>
<li>
<p>create a workspace</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_postgres_database">Postgres database</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Postgres database is only required to complete the last step or to run the full solution.
If you cannot get it to work on your machine, you can still complete all the other steps.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have Docker running on your machine, you can start the Postgres database in a container:</p>
</div>
<div class="listingblock">
<div class="title">Starting a Postgres Database with Docker</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">docker run <span class="nt">-p</span> 5432:5432 <span class="nt">-e</span> <span class="nv">POSTGRES_USER</span><span class="o">=</span>musicstore <span class="nt">-e</span> <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>musicstore <span class="nt">-d</span> postgres</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Linux and Mac users can simply execute the <code>run-postgres.sh</code> script after having imported the code in the next step.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otherwise:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>download Postgres from <a href="https://www.postgresql.org/download/" class="bare">https://www.postgresql.org/download/</a> and follow the instructions for your machine type</p>
</li>
<li>
<p>create a <code>musicstore</code> database</p>
</li>
<li>
<p>create a <code>musicstore</code> user with password <code>musicstore</code></p>
</li>
<li>
<p>grant the <code>musicstore</code> user with the permission to create tables on the the <code>musicstore</code> database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a <em>superuser</em> you could run these queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">musicstore</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">USER</span> <span class="n">musicstore</span> <span class="k">WITH</span> <span class="k">ENCRYPTED</span> <span class="n">PASSWORD</span> <span class="s1">'musicstore'</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="k">DATABASE</span> <span class="n">musicstore</span> <span class="k">TO</span> <span class="n">musicstore</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_importing_the_code">Importing the code</h3>
<div class="paragraph">
<p>The project code is hosted on GitHub.
Open a terminal in the directory of your choice and type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">git clone https://github.com/tsegismont/graphql-api-gateway-workshop.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you may download the <a href="https://codeload.github.com/tsegismont/graphql-api-gateway-workshop/zip/master">project archive</a> from GitHub and extract the content.</p>
</div>
<div class="paragraph">
<p>Inside the project directory, run Maven to build the project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">mvn <span class="nb">install</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now open the IDE and import the project.</p>
</div>
<div class="paragraph">
<p>In Eclipse:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>click on <em>File</em> &gt; <em>Import</em></p>
</li>
<li>
<p>select <em>Maven</em> &gt; <em>Existing Maven Projects</em></p>
</li>
<li>
<p>in <em>Root Directory</em>, type the project directory path or select it with the <em>Browse&#8230;&#8203;</em> button</p>
</li>
<li>
<p>make sure the root project and all sub-projects checkboxes are ticked and click <em>Finish</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In IntelliJ:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>click on <em>File</em> &gt; <em>New</em> &gt; <em>Project from Existing Sources</em></p>
</li>
<li>
<p>select the <code>pom.xml</code> file at the root of the project directory path and click <em>OK</em></p>
</li>
<li>
<p>click <em>Next</em> on the following wizard panels and then <em>Finish</em></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_running_backend_services">Running backend services</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Make sure you have built the project beforehand and started the Postgres database.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_inventory">Inventory</h4>
<div class="paragraph">
<p>Open a terminal at the root of the project directory and type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nb">cd </span>inventory
./run.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Windows, open the file explorer in the <code>inventory</code> directory and execute <code>run.bat</code>.</p>
</div>
<div class="paragraph">
<p>If the service starts correctly, you should see a line similar to this on the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[2019-11-02 21:05:24] [INFO   ] Succeeded in deploying verticle</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rating">Rating</h4>
<div class="paragraph">
<p>Open a terminal at the root of the project directory and type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nb">cd </span>rating
./run.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Windows, open the file explorer in the <code>rating</code> directory and execute <code>run.bat</code>.</p>
</div>
<div class="paragraph">
<p>If the service starts correctly, you should see a line similar to this on the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[2019-11-02 21:05:24] [INFO   ] Succeeded in deploying verticle</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lets_code">Let&#8217;s code!</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_building_blocks">Building blocks</h3>
<div class="sect3">
<h4 id="_graphql_java">GraphQL-Java</h4>
<div class="paragraph">
<p>The <a href="https://www.graphql-java.com/">GraphQL-Java</a> library is the Java implementation of the GraphQL specification.</p>
</div>
<div class="paragraph">
<p>To configure it, you must provide at least:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a GraphQL schema, either from a definition file or built programmatically</p>
</li>
<li>
<p>data fetchers functions for schema types and fields (<em>runtime wiring</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A GraphQL-Java data fetcher must implement the <code>graphql.schema.DataFetcher</code> interface.
In practice, it must have a <code>get</code> method that takes a <code>graphql.schema.DataFetchingEnvironment</code> argument and returns a result:</p>
</div>
<div class="listingblock">
<div class="title">DataFetcher interface</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DataFetcher</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="no">T</span> <span class="nf">get</span><span class="o">(</span><span class="nc">DataFetchingEnvironment</span> <span class="n">environment</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The result can be a <code>CompletionStage</code> if it is provided asynchronously.</p>
</div>
<div class="paragraph">
<p>The <em>environment</em> argument gives information about the current position in the graph: source type, arguments, fields to be fetched&#8230;&#8203; etc</p>
</div>
<div class="paragraph">
<p>The GraphQL-Java runtime job is to execute queries and it does not provide any transport implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_eclipse_vert_x">Eclipse Vert.x</h4>
<div class="paragraph">
<p><a href="https://vertx.io">Vert.x</a> is a toolkit to write asynchronous and reactive applications on the JVM.</p>
</div>
<div class="paragraph">
<p>It implements the reactor pattern and uses <em>Netty</em> for the networking layer.
It is similar to <em>Node.js</em> but it is capable of scaling across CPU cores instead of using a single thread.</p>
</div>
<div class="paragraph">
<p>Vert.x does not mandate any programming model but the easiest way to get started is to create a <em>verticle</em>.</p>
</div>
<div class="paragraph">
<p>A verticle is an entry-point class with a <em>start</em> method:</p>
</div>
<div class="listingblock">
<div class="title">Vert.x verticle</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyVerticle</span> <span class="kd">extends</span> <span class="nc">AbstractVerticle</span> <span class="o">{</span>

 <span class="c1">// Called when verticle is deployed</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
 <span class="o">}</span>

 <span class="c1">// Optional - called when verticle is undeployed</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
 <span class="o">}</span>

<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The core library provides low-level abstractions to start HTTP servers, work with the filesystem, &#8230;&#8203;etc.</p>
</div>
<div class="paragraph">
<p><a href="https://vertx.io/docs/vertx-web-graphql/java/">Vert.x Web GraphQL</a> integrates the GraphQL-Java library so that queries and results can be sent over HTTP and Websockets.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rxjava">RxJava</h4>
<div class="paragraph">
<p>Quotinq the <a href="https://github.com/ReactiveX/RxJava">RxJava</a> project website:</p>
</div>
<div class="quoteblock">
<blockquote>
RxJava  Reactive Extensions for the JVM  a library for composing asynchronous and event-based programs using observable sequences for the Java VM.
</blockquote>
<div class="attribution">
&#8212; RxJava project
</div>
</div>
<div class="paragraph">
<p>When working with asynchronous APIs, the code can quickly become difficult to understand if you need to execute several sequential operations.
It&#8217;s even worse when composing results of concurrent operations.</p>
</div>
<div class="paragraph">
<p>This issue is widely known as callback-hell and RxJava provides operators to deal with it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>CompletableFuture</code> / <code>CompletionStage</code> introduced in JDK 8 helps a lot with asynchronous composition.
But RxJava comes with a broader range of operators and is also able to deal with asynchronous data flows.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s take a couple of examples:</p>
</div>
<div class="listingblock">
<div class="title">Sequential composition: async Postgres query execution and transformation of row results into a Java object</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nc">Single</span><span class="o">&lt;</span><span class="nc">Cart</span><span class="o">&gt;</span> <span class="nf">findCart</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">pool</span><span class="o">.</span><span class="na">rxPreparedQuery</span><span class="o">(</span><span class="no">FIND_CART</span><span class="o">,</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">username</span><span class="o">))</span>
    <span class="o">.</span><span class="na">flatMapObservable</span><span class="o">(</span><span class="nl">Observable:</span><span class="o">:</span><span class="n">fromIterable</span><span class="o">)</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">CartRepository:</span><span class="o">:</span><span class="n">rowToCartItem</span><span class="o">)</span>
    <span class="o">.</span><span class="na">collectInto</span><span class="o">(</span><span class="k">new</span> <span class="nc">Cart</span><span class="o">(),</span> <span class="nl">Cart:</span><span class="o">:</span><span class="n">add</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Concurrent composition: combining results of async web client requests into a single Java object</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Single</span><span class="o">&lt;</span><span class="nc">Album</span><span class="o">&gt;</span> <span class="n">inventoryData</span> <span class="o">=</span> <span class="n">albumsRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="nc">Single</span><span class="o">&lt;</span><span class="nc">RatingInfo</span><span class="o">&gt;</span> <span class="n">ratingData</span> <span class="o">=</span> <span class="n">ratingRepository</span><span class="o">.</span><span class="na">findRatingAndReviewsByAlbum</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="k">return</span> <span class="n">inventoryData</span><span class="o">.</span><span class="na">zipWith</span><span class="o">(</span><span class="n">ratingData</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">a</span><span class="o">.</span><span class="na">setRating</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">getRating</span><span class="o">());</span>
  <span class="n">a</span><span class="o">.</span><span class="na">setReviews</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">getReviews</span><span class="o">());</span>
  <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, Vert.x uses a callback style but it also has an <a href="https://vertx.io/docs/vertx-rx/java2/">Rxified API</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_steps">Steps</h3>
<div class="paragraph">
<p>This lab is divided into several steps incrementally building the API Gateway for the <em>MusicStore</em> application.</p>
</div>
<div class="paragraph">
<p>Each step can be run separately.
To do so, open a terminal in the step directory and type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">mvn vertx:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then start coding.
The step projects all use the <em>Vert.x Maven plugin</em> which automatically redeploys the code when a file changes.</p>
</div>
<div class="paragraph">
<p>On Windows, open the file explorer in the step directory and execute <code>run.bat</code>.</p>
</div>
<div class="paragraph">
<p>The files to edit are either in the <code>src/main/java</code> or the <code>src/main/resources</code> directory.</p>
</div>
<div class="paragraph">
<p>Each step has its solution in the <code>src/solution</code> directory.
You may run it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">mvn clean package <span class="nt">-Psolution</span>
java <span class="nt">-jar</span> target/step-0.jar <span class="nt">-Dvertxweb</span>.environment<span class="o">=</span>dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Windows, open the file explorer in the step directory and execute <code>run-solution.bat</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
To avoid port conflicts, don&#8217;t forget to close the server before you start working on the next step.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A complete solution can be found in the <code>gateway</code> directory.</p>
</div>
<div class="sect3">
<h4 id="_step_0_vert_x_web_router">Step 0: Vert.x Web Router</h4>
<div class="paragraph">
<p>The Vert.x core library, as explained above, has very low-level abstractions for HTTP servers.</p>
</div>
<div class="paragraph">
<p><a href="https://vertx.io/docs/vertx-web/java/">Vert.x Web</a> is a module that builds on top of Vert.x core and provides features commonly found in a web server:
static file serving, session management, authentication and authorization and much more.</p>
</div>
<div class="paragraph">
<p>The basic Vert.x Web construct is the <em>Router</em>.
It allows to create <em>routes</em> matching requests by path or HTTP method and delegates execution to <em>handlers</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Router</span> <span class="n">router</span> <span class="o">=</span> <span class="nc">Router</span><span class="o">.</span><span class="na">router</span><span class="o">(</span><span class="n">vertx</span><span class="o">);</span> // <b class="conum">(1)</b>

<span class="n">router</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">handler</span><span class="o">(</span><span class="nc">StaticHandler</span><span class="o">.</span><span class="na">create</span><span class="o">());</span> // <b class="conum">(2)</b>

<span class="n">router</span><span class="o">.</span><span class="na">route</span><span class="o">().</span><span class="na">failureHandler</span><span class="o">(</span><span class="nc">ErrorHandler</span><span class="o">.</span><span class="na">create</span><span class="o">());</span> // <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Router creation for a given Vert.x instance</p>
</li>
<li>
<p>Any <code>GET</code> request should be handled by the <a href="https://vertx.io/docs/vertx-web/java/#_serving_static_resources"><code>StaticHandler</code></a> for static file serving</p>
</li>
<li>
<p>If anything gets wrong for any type of request, invoke the <a href="https://vertx.io/docs/vertx-web/java/#_error_handling"><code>ErrorHandler</code></a>.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_exercise">Exercise</h5>
<div class="paragraph">
<p>In the IDE, open the <code>steps/step-0/src/main/java/workshop/gateway/Step0Server.java</code> file.</p>
</div>
<div class="paragraph">
<p>Implement the TODOs found in the <code>createRouter</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_observations">Observations</h5>
<div class="paragraph">
<p>Browse to <a href="http://localhost:8080" class="bare">http://localhost:8080</a>.</p>
</div>
<div class="paragraph">
<p>The browser should display the <em>MusicStore</em> welcome page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The error message <em>Failed to load data&#8230;&#8203;</em> is expected as we haven&#8217;t implemented the GraphQL runtime yet.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_1_the_graphql_java_runtime">Step 1: The GraphQL-Java runtime</h4>
<div class="paragraph">
<p>Now that we have a web server, let&#8217;s configure the GraphQL runtime.</p>
</div>
<div class="paragraph">
<p>Firstly, we need a GraphQL schema file.</p>
</div>
<div class="paragraph">
<p>The schema must contain at least a root <code>Query</code> type and its fields are the entry points to the graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="graphql"><span class="k">type</span><span class="w"> </span><span class="n">Genre</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">!</span><span class="w"> # <b class="conum">(3)</b>
  </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w"> # <b class="conum">(4)</b>
  </span><span class="n">image</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="k">type</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="p">{</span><span class="w"> # <b class="conum">(1)</b>
  </span><span class="n">genres</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">Genre</span><span class="p">!]</span><span class="w"> # <b class="conum">(2)</b>
</span><span class="p">}</span><span class="w">

</span><span class="k">schema</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="n">Query</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>root query type</p>
</li>
<li>
<p>the <code>genres</code> field returns an array of <code>Genre</code> objects</p>
</li>
<li>
<p><code>Integer</code> is one of the built-in scalar types</p>
</li>
<li>
<p>fields are nullable unless marked by <code>!</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Secondly, we must configure the runtime to define data fetchers.
In GraphQL-Java this is called <em>runtime wiring</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">protected</span> <span class="nc">RuntimeWiring</span> <span class="nf">runtimeWiring</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">RuntimeWiring</span><span class="o">.</span><span class="na">newRuntimeWiring</span><span class="o">()</span>
    <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"Query"</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">query</span><span class="o">)</span> // <b class="conum">(1)</b>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="nc">TypeRuntimeWiring</span><span class="o">.</span><span class="na">Builder</span> <span class="nf">query</span><span class="o">(</span><span class="nc">TypeRuntimeWiring</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">builder</span>
    <span class="o">.</span><span class="na">dataFetcher</span><span class="o">(</span><span class="s">"genres"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">GenresDataFetcher</span><span class="o">(</span><span class="n">genresRepository</span><span class="o">))</span> // <b class="conum">(2)</b>
    <span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Runtime wiring configuration of the root <code>Query</code> type provided by the <code>query</code> method</p>
</li>
<li>
<p>Define the <code>GenresDataFetcher</code> object for the <code>genres</code> field of the <code>Query</code> type</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>workshop.gateway.WorkshopVerticle</code> class exposes a few repositories that implement the data access layer to the inventory service, the rating service, as well as the Postgres database.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>GenresDataFetcher</code> extends <code>workshop.gateway.RxDataFetcher</code>, which is an adpater for the RxJava <code>Single</code> type that GraphQL-Java does not understand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">package</span> <span class="n">workshop</span><span class="o">.</span><span class="na">gateway</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">graphql.schema.DataFetcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">graphql.schema.DataFetchingEnvironment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">hu.akarnokd.rxjava2.interop.SingleInterop</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.reactivex.Single</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.CompletionStage</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RxDataFetcher</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">DataFetcher</span><span class="o">&lt;</span><span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="k">default</span> <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">get</span><span class="o">(</span><span class="nc">DataFetchingEnvironment</span> <span class="n">environment</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">Single</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">single</span> <span class="o">=</span> <span class="n">rxGet</span><span class="o">(</span><span class="n">environment</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">single</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span><span class="o">:</span><span class="n">single</span><span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="nc">SingleInterop</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nc">Single</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">rxGet</span><span class="o">(</span><span class="nc">DataFetchingEnvironment</span> <span class="n">env</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, the Vert.x Web router must declare a route for <code>/graphql</code> requests and set the <code>GraphQLHandler</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">GraphQL</span> <span class="n">graphQL</span> <span class="o">=</span> <span class="n">setupGraphQLJava</span><span class="o">(</span><span class="s">"musicstore.graphql"</span><span class="o">);</span>
<span class="n">router</span><span class="o">.</span><span class="na">route</span><span class="o">(</span><span class="s">"/graphql"</span><span class="o">).</span><span class="na">handler</span><span class="o">(</span><span class="nc">GraphQLHandler</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">graphQL</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_exercise_2">Exercise</h5>
<div class="paragraph">
<p>In the IDE, open the <code>steps/step-1/src/main/resources/musicstore.graphql</code> file.</p>
</div>
<div class="paragraph">
<p>Implement the TODOs found in the <code>Genre</code> and <code>Query</code> types.</p>
</div>
<div class="paragraph">
<p>Open the <code>steps/step-1/src/main/java/workshop/gateway/Step1Server.java</code> file.</p>
</div>
<div class="paragraph">
<p>Implement the TODOs found in the <code>createRouter</code> and <code>query</code> methods.</p>
</div>
<div class="paragraph">
<p>Open the <code>steps/step-1/src/main/java/workshop/gateway/GenresDataFetcher.java</code> file.</p>
</div>
<div class="paragraph">
<p>Implement the TODOs found in the <code>rxGet</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_observations_2">Observations</h5>
<div class="paragraph">
<p>Browse to <a href="http://localhost:8080" class="bare">http://localhost:8080</a>.</p>
</div>
<div class="paragraph">
<p>The browser should display the list of genres available in the <em>MusicStore</em>.</p>
</div>
<div class="paragraph">
<p>Browse to <a href="http://localhost:8080/graphiql/" class="bare">http://localhost:8080/graphiql/</a>.</p>
</div>
<div class="paragraph">
<p>GraphiQL is an IDE to author GraphQL queries.</p>
</div>
<div class="paragraph">
<p>In the query panel, type the following query and execute it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="graphql"><span class="k">query</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">genres</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the results panel you should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"genres"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Modify the query to fetch other fields (<code>name</code> or <code>image</code>).
The result should have exactly the information you required, no more no less.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
In the top right corner of the web page, click the <code>Docks</code> link.
GraphiQL will open the schema explorer.
This can be useful when working with a schema that you do not own.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_2_field_with_argument">Step 2: field with argument</h4>
<div class="paragraph">
<p>GraphQL types can have fields taking arguments.
This can be useful for filtering or paging results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="graphql"><span class="k">type</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">genres</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">Genre</span><span class="p">!]</span><span class="w">
  </span><span class="n">albums</span><span class="p">(</span><span class="n">genre</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">):</span><span class="w"> </span><span class="p">[</span><span class="n">Album</span><span class="p">!]</span><span class="w"> # <b class="conum">(1)</b>
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>the <code>albums</code> field of the root <code>Query</code> type takes a <code>genre</code> argument of type <code>Int</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the data fetcher implementation, the argument value is retrieved from the <code>DataFetchingEnvironment</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Integer</span> <span class="n">genre</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">getArgument</span><span class="o">(</span><span class="s">"genre"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_exercise_3">Exercise</h5>
<div class="paragraph">
<p>In the IDE, open the <code>steps/step-2/src/main/resources/musicstore.graphql</code> file.</p>
</div>
<div class="paragraph">
<p>Implement the TODOs found in the <code>Album</code> and <code>Query</code> types.</p>
</div>
<div class="paragraph">
<p>Open the <code>steps/step-2/src/main/java/workshop/gateway/Step2Server.java</code> file.</p>
</div>
<div class="paragraph">
<p>Implement the TODO found in the <code>query</code> method.</p>
</div>
<div class="paragraph">
<p>Open the <code>steps/step-2/src/main/java/workshop/gateway/AlbumsDataFetcher.java</code> file.</p>
</div>
<div class="paragraph">
<p>Implement the TODO found in the <code>rxGet</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_observations_3">Observations</h5>
<div class="paragraph">
<p>Browse to <a href="http://localhost:8080/graphiql/" class="bare">http://localhost:8080/graphiql/</a>.</p>
</div>
<div class="paragraph">
<p>In the query panel, type the following query and execute it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="graphql"><span class="k">query</span><span class="p">(</span><span class="nv">$genre</span><span class="p">:</span><span class="nb">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">albums</span><span class="p">(</span><span class="n">genre</span><span class="p">:</span><span class="w"> </span><span class="nv">$genre</span><span class="p">)</span><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="w">
    </span><span class="n">name</span><span class="w">
    </span><span class="n">genre</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">name</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="n">artist</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the results panel you should see all albums because we haven&#8217;t provided any value for this nullable argument.</p>
</div>
<div class="paragraph">
<p>Then open the query variables panel and type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="nl">"genre"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute the query again.
Now in the results panel you should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"albums"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dark Side Of The Moon"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"genre"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rock"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"artist"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pink Floyd"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Appetite For Destruction"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"genre"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rock"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"artist"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Guns N' Roses"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Back In Black"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"genre"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rock"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"artist"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AC/DC"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Master Of Puppets"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"genre"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rock"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"artist"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Metallica"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-11-04 22:55:12 UTC
</div>
</div>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</body>
</html>